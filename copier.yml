_subdirectory: template
_templates_suffix: .j2
_skip_if_exists:
  - .env
  - .env.local

company_name:
  type: str
  help: Your company name
  placeholder: Company Name, S.L.
  default: All Tuner Labs, S.L.

author_name:
  type: str
  help: Your full name
  placeholder: FirstName LastName

author_email:
  type: str
  help: Your email address
  placeholder: hello@example.com

project_name:
  type: str
  help: What is the name of your project?
  default: "{{ _folder_name }}"
  validator: >-
    {% if not (project_name | regex_search('^[a-z][a-z0-9\-]*[a-z0-9]$')) %}
    project_name must start with a letter, followed one or more letters, digits or dashes all lowercase ending with a letter or digit.
    {% endif %}

enable_web:
  type: bool
  help: Do you want to enable web stuff?
  default: true

cloudflare_api_key:
  type: str
  placeholder: "XXXXXXXXXX_yyyyyyyyyyyyyyyyyyyyyyyyyyyyy"
  help: The CF API key that will be used for the environment (needs permissions)
  default: ""
  when: "{{ not setup_cloudflare and enable_web }}"

project_description:
  type: str
  help: What is the description of your project?
  default: A project that does something useful.

python_version:
  type: str
  help: Select your Python version
  default: "3.13"
  choices:
    - "3.10"
    - "3.11"
    - "3.12"
    - "3.13"

supported_languages:
  type: yaml
  multiline: true
  help: List of 2 letter lang codes in JSON format of supported languages (in addition to English)

use_github_repo:
  type: bool
  help: Do you want to commit to a github repo?
  default: false

github_repo:
  type: str
  help: ORG/repo or USER/repo github repo to create
  when: "{{ use_github_repo }}"
  default: "alltuner/{{ project_name }}"
  validator: >-
    {% if not (github_repo | regex_search('^[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9]/[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9]$')) %}
    github_repo must contain an org or a username followed by a slash and a repo name
    {% endif %}

setup_fqdn:
  type: bool
  help: Do you want to configure a FQDN?
  default: false
  when: "{{ enable_web }}"

fqdn:
  type: str
  placeholder: subdomain.example.com
  help: What's the fqdn of your website?
  when: "{{ setup_fqdn }}"
  validator: >-
    {% if not (fqdn | regex_search('^(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$')) %}
    fqdn must be a valid fully qualified domain name like subdomain.example.com
    {% endif %}

umami_website_id:
  type: str
  placeholder: "98357f85-ccdd-4544-aaaa-e57a27e53dde"
  help: What's the unique ID for Umami analytics?
  when: "{{ enable_web and setup_fqdn }}"

setup_cloudflare:
  type: bool
  help: Do you want to configure automatically Cloudflare (DNS Record and SSL Mode=strict)?
  default: false
  when: "{{ enable_web and cloudflare_api_key and setup_fqdn }}"

setup_caddy:
  type: bool
  help: Do you want to configure Caddy to serve requests?
  default: true
  when: "{{ enable_web and cloudflare_api_key and setup_fqdn }}"

enable_watchtower:
  type: bool
  help: Do you want to enable watchtower (containers self-reload on update)?
  default: true
  when: "{{ enable_web }}"

deploy_to_production:
  type: bool
  help: Do you want to deploy to production?
  default: false
  when: "{{ enable_web }}"

_tasks:
  - command: [uv, tool, install, dunamai]
    when: "{{ _copier_phase == 'prompt' }}"
  - command: [uv, tool, install, semver]
    when: "{{ _copier_phase == 'prompt' }}"
  - command: [uv, tool, install, "python-dotenv[cli]"]
    when: "{{ _copier_phase == 'prompt' }}"
  - command: [uv, tool, install, copier]
    when: "{{ _copier_phase == 'prompt' }}"
  - command: [uv, tool, install, babel]
    when: "{{ _copier_phase == 'prompt' }}"
  - command: [uv, tool, install, pre-commit]
    when: "{{ _copier_phase == 'prompt' }}"
  - command: [just, mise-trust]
    when: "{{ _copier_operation == 'copy' }}"
  - command: [just, git-init, "{{ project_name }}"]
    when: "{{ _copier_operation == 'copy' }}"
  - command: [pre-commit, install]
    when: "{{ _copier_operation == 'copy' }}"
  - command: [just, create-github-repo, "{{ github_repo }}"]
    when: "{{ _copier_operation == 'copy' and use_github_repo }}"
  - command: [just, "-E", ".env", add-dns-record, "{{ fqdn }} "]
    when: "{{ _copier_operation == 'copy' and setup_cloudflare and enable_web }}"
  - command: [just, deploy-latest, durian]
    when: "{{ _copier_operation == 'copy' and deploy_to_production and enable_web }}"
